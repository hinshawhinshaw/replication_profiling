#!/bin/bash


##input is a directory with fasq files, which i generated by running fastq-dump
##add path to bedtools to local environment
setenv PATH $PATH\:"/Users/hinshaw/Desktop/bedtools2 21-51-46/bin"
setenv PATH $PATH\:"/Users/hinshaw/Desktop/bowtie2-2.2.3"

##align fastq reads to reference genome
for fastq in 'ls *.fastq | sed 's/.fastq//' '
do
echo ${fastq}
bowtie2 -x /nfs/userdocs/sch/hinshaw/Desktop/temp_yeast/newref/test -U ${fastq}.fastq -S ${fastq}.sam


##convert .sam files to .bam files (binary, saves space, easy to manipulate)
for sam in 'ls *.sam | sed 's/.sam//' '
do
echo ${sam}
samtools view -bS ${sam}.sam > ${sam}.tmpbam


##sort .bam files
for tmpbam in 'ls *.tmpbam | sed 's/.tmpbam//' '
do
echo ${tmpbam}
samtools sort ${tmpbam}.tmpbam ${tmpbam}


##index sort_bam files
for bam in 'ls *.bam | sed 's/.bam//' '
do
echo ${bam}
samtools index ${bam}.bam ${bam}.bai


##run bedtools on all bedfiles in specified directory in next line

"""
for bam in 'ls *.bam | sed 's/.bam//' '
do
echo ${bam}
bedtools multicov -D -q 10 -bams ${bam}.bam -bed /nfs/xray/sch/hinshaw/sequencing_data/20150528_replication_gerton/100kb_windows.bed \
| cut -f4,5 > ${bam}.tmpcnt &
done
wait
"""
